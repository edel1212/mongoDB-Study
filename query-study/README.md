# MongoDB Query Study

```properties
# â„¹ï¸ Dockerë¥¼ ì‚¬ìš©í•´ì„œ ì‹¤í–‰í•¨
#   - Mongo Compass GUI Toolì„ í™œìš©í•˜ì—¬ í™•ì¸
```

## Set-Up
### MongoDB ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
`docker pull mongo`

### Container ìƒì„±
```shell
docker run -d --name mongodb -v C:\Users\edel1\Desktop\docker-volume\mongo:/data/db -e MONGO_INITDB_ROOT_USERNAME=root -e MONGO_INITDB_ROOT_PASSWORD=123 -p 27017:27017 mongo
```
- ì •ìƒ ë™ì‘ í™•ì¸ ë°©ë²• ì•„ë˜ ë§í¬ í´ë¦­ ì‹œ í™•ì¸ ê°€ëŠ¥í•¨
    - `http://localhost:{ì§€ì • í¬íŠ¸ë²ˆí˜¸}`

### Mongo DB ì ‘ì†
- ì»¨í…Œì´ë„ˆ ì ‘ê·¼
    - `docker exec -it {{containerName}} /bin/bash`
- MongoDB ì ‘ì†
    - `mongosh -u root -p`

## Database

### Database ëª©ë¡ í™•ì¸
- `show dbs`
    - í•´ë‹¹ ëª…ë ¤ì–´ ì‚¬ìš©ì‹œ ë¯¸ë¦¬ ë§Œë“¤ì–´ì§„ 3ê°œì˜ Databaseë¥¼ í™•ì¸ í•  ìˆ˜ ìˆìŒ
    -
    ![img.png](img.png)

    - ê°ê°ì˜ ì„¤ëª…
        - admin
            - ê´€ë¦¬ìš© ë°ì´í„°ë² ì´ìŠ¤ (ê¶Œí•œ ë° í´ëŸ¬ìŠ¤í„° ì„¤ì •). ë£¨íŠ¸ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ì‚¬ìš©
            - ì‹œìŠ¤í…œ ìˆ˜ì¤€ì˜ ê´€ë¦¬ ì‘ì—…(ì‚¬ìš©ì ê´€ë¦¬, ê¶Œí•œ ì„¤ì • ë“±)ì€ ëŒ€ë¶€ë¶„ admin ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì´ë£¨ì–´ì§
            - ì‚¬ìš©ì ì¸ì¦
                - ì‚¬ìš©ìê°€ admin ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¸ì¦ë˜ë©´, MongoDB ì¸ìŠ¤í„´ìŠ¤ ì „ì²´ì— ëŒ€í•œ ê¶Œí•œì„ ê°€ì§ˆ ìˆ˜ ìˆìŒ
                - ì˜ˆ) root ì—­í• ì„ ê°€ì§„ ì‚¬ìš©ìë¥¼ admin ë°ì´í„°ë² ì´ìŠ¤ì— ì¶”ê°€í•˜ë©´, ì´ ì‚¬ìš©ìëŠ” **ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê´€ë¦¬**í•  ìˆ˜ ìˆìŒ
            - í´ëŸ¬ìŠ¤í„° ê´€ë¦¬
                - ë³µì œë³¸ ì„¸íŠ¸(replica set), ìƒ¤ë“œ í´ëŸ¬ìŠ¤í„°(sharded cluster) ê´€ë¦¬ì™€ ê°™ì€ ê³ ê¸‰ ì‘ì—…ë„ admin ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì„¤ì •
            - ì„œë²„ ì •ë³´ ì €ì¥
                - ì¼ë¶€ ì‹œìŠ¤í…œ ì •ë³´ì™€ ì„œë²„ ìƒíƒœê°€ admin ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë©ë‹ˆë‹¤.
        - local
            - ì„œë²„ë³„ ë°ì´í„°ë² ì´ìŠ¤.
            - ë³µì œë³¸ ì„¸íŠ¸ ì„¤ì • ë° ë³µì œë˜ì§€ ì•ŠëŠ” ë°ì´í„°ë¥¼ ì €ì¥.
        - config:
            - ìƒ¤ë“œ í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥.

### Database ìƒì„±
- `use {ìƒì„±í•˜ê³  ì‹¶ì€ ë°ì´í„° ë² ì´ìŠ¤ëª…}`
    - ì¡´ì¬í•˜ì§€ ì•ŠëŠ” Databaseë¥¼ ì„ íƒí•´ë„ **ì—ëŸ¬ê°€ ë‚˜ì§€ ì•ŠìŒ**
        - ë°ì´í„°ë² ì´ìŠ¤ "ì•”ì‹œì  ìƒì„±" ìƒíƒœì´ê¸° ë•Œë¬¸ì„ MongoDBëŠ” Collectionì„ ì¶”ê°€ ì‹œ ì§„ì§œ Databaseê°€ ìƒì„±ëœë‹¤.
    - "ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤"ê¸°ë³´ë‹¤ëŠ” "ì„ íƒí•œë‹¤"ëŠ” ì˜ë¯¸í•¨.

### Database ì‚­ì œ
> ì‚­ì œí•  Database ì´ë™
- `db.dropDatabase();'

### Database í™•ì¸
- í˜„ì¬ Database í™•ì¸
    - `db`
- ë‚´ê°€ ë§Œë“  Database List í™•ì¸
    - `show dbs`

<hr/>

## ê³„ì •

### Role ì¢…ë¥˜

| ì—­í•  (Role)      | ì„¤ëª…                                                          |
|-------------------|---------------------------------------------------------------|
| `read`           | ì§€ì •ëœ ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì½ê¸° ê¶Œí•œ                          |
| `readWrite`      | ì§€ì •ëœ ë°ì´í„°ë² ì´ìŠ¤ì— ëŒ€í•œ ì½ê¸° ë° ì“°ê¸° ê¶Œí•œ                  |
| `dbAdmin`        | ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ê¶Œí•œ (ì¸ë±ìŠ¤ ê´€ë¦¬, í†µê³„ ì¡°íšŒ ë“±)            |
| `userAdmin`      | ì‚¬ìš©ì ê´€ë¦¬ ê¶Œí•œ                                              |
| `clusterAdmin`   | í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ê¶Œí•œ                                           |
| `root`           | ëª¨ë“  ê¶Œí•œ (ìŠˆí¼ìœ ì €)                                         |


### ê³„ì • ìƒì„±
- admin Database ì„ íƒ
    - `use admin`
- ê³„ì • ìƒì„±
    - **"db"ê°€ "admin"** ì´ê¸°ì— **ëª¨ë“  Databaseì— ê¶Œí•œ**ì„ ê°–ëŠ”ë‹¤
  ```javascript
  db.createUser(
  {
    user: "yoo",
    pwd:  "123",
    roles: [
    	{ "role" : "root", "db" : "admin" },
	]
  }
  ```

### ê³„ì • ì‚­ì œ
> ì‚­ì œí•  ëŒ€ìƒì´ ìˆëŠ” Database ì„ íƒ
- `db.dropUser("{{ì‚­ì œ ëŒ€ìƒ ID}}");`

### ê³„ì • ì •ë³´ ìˆ˜ì •
> ë³€ê²½í•  ëŒ€ìƒì´ ìˆëŠ” Database ì„ íƒ
- ```javascript
  db.updateUser("{{ëŒ€ìƒ ID}}", {
    pwd: "{{ë³€ê²½í•  PW}}", // ë³€ê²½í•  ë¹„ë°€ë²ˆí˜¸ - optional
    roles: [ { role: "{{ì§€ì • ê¶Œí•œ}}", db: "<database_name>" } ] // ë³€ê²½í•  ê¶Œí•œ - optional
  });
  ```


### ê³„ì • ëª©ë¡ í™•ì¸
- `db.getUsers()`

<hr/>

## Collection (Table)

### Collection ìƒì„±
- ëª…ë ¹ì–´ : `db.createCollection(name, [options]) `
- ê¸°ë³¸ ìƒì„±
    - `db.createCollection("ìƒì„±í•  Collectioëª…")`
- ì˜µì…˜ ì¶”ê°€ ìƒì„±
    - ì˜µì…˜ ì¢…ë¥˜
        -  capped :  true ë¡œ ì„¤ì • ì‹œ **ê³ ì •ëœ í¬ê¸°(fixed size)ë¥¼ ê°€ì§„ Collectionìœ¼ë¡œ ë§Œë“¤ì–´ì§**
            -  size ê°€ ì´ˆê³¼ë˜ë©´ **ê°€ì¥ ì˜¤ë˜ëœ ë°ì´í„°ë¥¼ ë®ì–´ ì”Œì›€**
                - trueë¡œ ì„¤ì •í•˜ë©´ size ê°’ì„ ê¼­ ì„¤ì •í•´ì•¼ í•¨
            - autoIndexId : trueë¡œ ì„¤ì •í•˜ë©´, _id í•„ë“œì— **indexë¥¼ ìë™ìœ¼ë¡œ ìƒì„±** (Default : false)
            - size :  Capped collection ì‚¬ìš© ì‹œ ì»¬ë ‰ì…˜ì˜ ìµœëŒ€ ì‚¬ì´ì¦ˆ(maximum size)ë¥¼ ~ bytesë¡œ ì§€ì •
                - max :  COllectionì— **ì¶”ê°€ í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ê°¯ìˆ˜ë¥¼ ì„¤ì •**
    -  ```javascript
    	   db.createCollection("articles", {
		capped: true,
		autoIndex: true,
		size: 6142800,
		max: 10000
           })
	   ```

### Collection ì‚­ì œ
- ëª…ë ¹ì–´ : `db.Collectionëª….drop() `

## Document (Row - ë°ì´í„°)

### Document ì¶”ê°€(Insert)
```properties
# â„¹ï¸ Document Insert ì‹œ ìë™ìœ¼ë¡œ _idê°€ ì¦ê°€ë˜ëŠ”ê²ƒì„ í™•ì¸ ìˆë‹¤.
#    - í•´ë‹¹ ê°’ì€ ê°’ì„ ê°ê°ì˜ Documentë¥¼ ì‹ë³„í•˜ê¸° ìœ„í•œ PKì´ë©° í•„ìˆ˜ê°’ì´ë‹¤.
#      ã„´ _Idë¥¼ ì§€ì • ì£¼ì… ê°€ëŠ¥í•˜ë‚˜ ì¤‘ë³µëœ ê°’ì€ ë¶ˆê°€ëŠ¥   
#          ã„´ db.users.insertOne({{ "_id": "Hi_Im_yoo", "name": "Alice", })
```
- ëª…ë ¹ì–´ : `db.COLLECTION_NAME.insertOne(document)` , `db.COLLECTION_NAME.insertMany(document)`

    - Ex)  `db.foo.insertOne({"name": "ìœ ì •í˜¸", "age": 120})` ,  `db.foo.insertMany([ {"name": "ê°", "age": 20}, {"name": "ì‚¬ê³¼", "age": 30} ])`

### Document ì¡°íšŒ
```properties
# â„¹ï¸ pretty()ë¥¼ ë’¤ì— ë¶™ì´ë©´ ë³´ê¸° ì¢‹ê²Œ ì •ë¦¬ ë˜ì–´ ë‚˜ì˜´
#   ã„´> Ex) db.COLLECTION_NAME.find([OPTIONS]).pretty()ê°€ëŠ¥í•˜ë‹¤
```
- ê¸°ë³¸ ì¡°íšŒ ëª…ë ¹ì–´
    - ì „ì²´ ì¡°íšŒ  `db.COLLECTION_NAME.find([OPTIONS]) ` 
        - EX)
            -  `db.foo.find();` :  ì „ì²´ ì¡°íšŒ
            -  `db.foo.find({name : "ìœ ì •í˜¸"});` : nameì´ "ìœ ì •í˜¸"ë§Œ ì¡°íšŒ
            - `db.foo.find({ name: "yoo" }, { age: 0, name: 0 });`  nameì´ "ìœ ì •í˜¸"ë§Œ ì¡°íšŒí•˜ë©´ì„œ  nameê³¼ ageë¥¼ ì œì™¸í•˜ê³  ë³´ì—¬ì¤Œ
                - 0 : ìˆ¨ê¹€ , 1 : ë³´ì—¬ì§ >> ğŸ¤¯ 0, 1 í˜¼í•© ì‚¬ìš© ë¶ˆê°€ëŠ¥í•˜ë‹¤!!
    - ë‹¨ê±´ ì¡°íšŒ  `db.COLLECTION_NAME.findOne([OPTIONS]) ` 

#### ë¹„êµ(Comparison) ì—°ì‚°ì

| ì—°ì‚°ì   | ì„¤ëª…                           | ë¶€ë“±í˜¸ í‘œí˜„     | ì‚¬ìš© ì˜ˆì‹œ                                         |
|----------|--------------------------------|-----------------|--------------------------------------------------|
| `$eq`    | ì£¼ì–´ì§„ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ê°’        | `=`             | `{ age: { $eq: 25 } }` (ageê°€ 25ì¸ ë¬¸ì„œ ì°¾ê¸°)     |
 | `$ne`    | ì£¼ì–´ì§„ ê°’ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê°’    | `!=`            | `{ age: { $ne: 25 } }` (ageê°€ 25ê°€ ì•„ë‹Œ ë¬¸ì„œ ì°¾ê¸°)|
| `$gt`    | ì£¼ì–´ì§„ ê°’ë³´ë‹¤ í° ê°’            | `>`             | `{ age: { $gt: 25 } }` (ageê°€ 25ë³´ë‹¤ í° ë¬¸ì„œ ì°¾ê¸°)|
| `$gte`   | ì£¼ì–´ì§„ ê°’ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ì€ ê°’    | `>=`            | `{ age: { $gte: 25 } }` (ageê°€ 25 ì´ìƒì¸ ë¬¸ì„œ ì°¾ê¸°)|
| `$lt`    | ì£¼ì–´ì§„ ê°’ë³´ë‹¤ ì‘ì€ ê°’          | `<`             | `{ age: { $lt: 25 } }` (ageê°€ 25ë³´ë‹¤ ì‘ì€ ë¬¸ì„œ ì°¾ê¸°)|
| `$lte`   | ì£¼ì–´ì§„ ê°’ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ì€ ê°’    | `<=`            | `{ age: { $lte: 25 } }` (ageê°€ 25 ì´í•˜ì¸ ë¬¸ì„œ ì°¾ê¸°)|
| `$in`    | ì£¼ì–´ì§„ ë°°ì—´ ì•ˆì— ì†í•˜ëŠ” ê°’      | ê°’ ë¦¬ìŠ¤íŠ¸ í¬í•¨  | `{ age: { $in: [20, 25, 30] } }` (20, 25, 30 ì¤‘ í•˜ë‚˜ ì°¾ê¸°)|
| `$nin`   | ì£¼ì–´ì§„ ë°°ì—´ ì•ˆì— ì†í•˜ì§€ ì•ŠëŠ” ê°’ | ê°’ ë¦¬ìŠ¤íŠ¸ ì œì™¸  | `{ age: { $nin: [20, 25, 30] } }` (20, 25, 30 ì œì™¸)|

- ì¡°ê±´ ì¡°íšŒ ì˜ˆì‹œ
  - likes 30 ì´ˆê³¼ 40 ë¯¸ë§Œ: `db.book.find({likes : {$gt : 30, $lt : 40}})`
  - IN ì¡°íšŒ  "Aplpha","Bravo" ê°€ ë“¤ì–´ìˆëŠ” : `db.book.find({ writer: { $in: ["Alpha", "Bravo"] } });`


    
    

### Document ì‚­ì œ
- ëª…ë ¹ì–´
    - ë‹¨ê±´ ì‚­ì œ : `db.COLLECTION_NAME.deleteOne( ì¡°ê±´ê°’ )`
        - Ex) `db.book.deleteOne({name : "ìœ ì •í˜¸"})`
    - ì—¬ëŸ¬ê°œ  ì‚­ì œ : `db.COLLECTION_NAME.deleteOne( ì¡°ê±´ê°’ )`
        - - Ex) `db.book.deleteMany({name : "ìœ ì •í˜¸"})`


### Document ì—…ë°ì´íŠ¸